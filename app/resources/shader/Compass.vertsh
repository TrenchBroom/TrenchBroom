#version 120

/*
 Copyright (C) 2010-2017 Kristian Duske

 This file is part of TrenchBroom.

 TrenchBroom is free software: you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
 the Free Software Foundation, either version 3 of the License, or
 (at your option) any later version.

 TrenchBroom is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.

 You should have received a copy of the GNU General Public License
 along with TrenchBroom. If not, see <http://www.gnu.org/licenses/>.
 */

uniform vm::vec3 CameraPosition;
uniform vm::vec3 LightDirection;
uniform vm::vec4 LightDiffuse;
uniform vm::vec4 LightSpecular;
uniform vm::vec4 MaterialDiffuse;
uniform vm::vec4 MaterialAmbient;
uniform vm::vec4 MaterialSpecular;
uniform float MaterialShininess;
uniform vm::vec4 GlobalAmbient;

void main(void) {
	gl_Position = gl_ProjectionMatrix * gl_ModelViewMatrix * gl_Vertex;
    
    vm::vec3 normal = normalize(gl_NormalMatrix * gl_Normal);
    float NdotL = max(dot(normal, LightDirection), 0.0); // cosine of normal and light direction

    vm::vec4 diffuse = NdotL * LightDiffuse * MaterialDiffuse;
    vm::vec4 ambient = GlobalAmbient * MaterialAmbient;

    vm::vec3 eyeVector = normalize(CameraPosition - gl_Vertex.xyz);
    vm::vec3 halfVector = normalize(eyeVector - LightDirection);
    float NdotHV = max(-dot(normal, halfVector), 0.0);
    vm::vec4 specular = MaterialSpecular * LightSpecular * pow(NdotHV, MaterialShininess);

	gl_FrontColor = vm::vec4((diffuse + ambient + specular).xyz, 1.0);
}
